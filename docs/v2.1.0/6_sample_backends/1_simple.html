<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple Arithmetic Demo Backend - WizToolKit</title>
    <link rel="stylesheet"
        href="/wiztoolkit/assets/css/fonts.css" />
    <link rel="stylesheet"
        href="/wiztoolkit/assets/css/layout.css" />
    <link rel="stylesheet"
        href="/wiztoolkit/assets/css/content.css" />

    <link rel="shortcut icon" type="image/png"
        href="/wiztoolkit/assets/icons/tetra-solid-32x32.png" />

    <link type="application/atom+xml" rel="alternate" href="https://stealthsoftwareinc.github.io/wiztoolkit/feed.xml" title="WizToolKit" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Simple Arithmetic Demo Backend | WizToolKit</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Simple Arithmetic Demo Backend" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://stealthsoftwareinc.github.io/wiztoolkit/docs/v2.1.0/6_sample_backends/1_simple.html" />
<meta property="og:url" content="https://stealthsoftwareinc.github.io/wiztoolkit/docs/v2.1.0/6_sample_backends/1_simple.html" />
<meta property="og:site_name" content="WizToolKit" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Simple Arithmetic Demo Backend" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Simple Arithmetic Demo Backend","url":"https://stealthsoftwareinc.github.io/wiztoolkit/docs/v2.1.0/6_sample_backends/1_simple.html"}</script>
<!-- End Jekyll SEO tag -->


    <script>0</script>
  </head>
  <body>
    <header>
      <nav id="topNav">
        <a href="#main" id="jumpMain">Jump to Main</a>
        <a href="https://www.stealthsoftwareinc.com" id="logoImg">
          <img
            src="/wiztoolkit/assets/icons/tetra-solid-100x100.png"
            alt="Stealth Software Technologies Home Page" /></a>
        <a href="/wiztoolkit/" id="titleLink">WizToolKit</a>
        <span id="spacer">&nbsp;</span>
        
          
            <a href="/wiztoolkit/"
              
              >about</a>
          
        
          
            <a href="/wiztoolkit/docs/v2.1.0/"
              
              >docs</a>
          
        
          
            <a href="https://github.com/stealthsoftwareinc/wiztoolkit"
              
              >source</a>
          
        
      </nav>
    </header>
    <nav id=docsNav>
  <div>
    <h2 class="eyebrow">Docs Nav</h2>
    <p>
      <label for="version_select">Change Version:</label> <select name="version_select" onchange="location = this.value;"><option selected value="/wiztoolkit/docs/v2.1.0/">v2.1.0</option><option  value="/wiztoolkit/docs/v1.0.1/">v1.0.1</option></select>
    </p>

    
    <ul><li><a href="/wiztoolkit/docs/v2.1.0/">WizToolKit Manual</a><ul><li><a href="/wiztoolkit/docs/v2.1.0/0_intro.html">Introduction to the WizToolKit Manual</a></li><li><a href="/wiztoolkit/docs/v2.1.0/1_parsing.html">Parsing the IR</a></li><li><a href="/wiztoolkit/docs/v2.1.0/2_nails.html">NAILS Circuit-IR Interpreter</a></li><li>3_plugins<ul><li><a href="/wiztoolkit/docs/v2.1.0/3_plugins/0_intro.html">Plugins Intro</a></li><li><a href="/wiztoolkit/docs/v2.1.0/3_plugins/1_extended_arithmetic.html">The Extended Arithmetic Plugin</a></li><li><a href="/wiztoolkit/docs/v2.1.0/3_plugins/1_iter_v0.html">Iteration v0 Plugin</a></li><li><a href="/wiztoolkit/docs/v2.1.0/3_plugins/1_mux_v0.html">The Mux v0 Plugin</a></li><li><a href="/wiztoolkit/docs/v2.1.0/3_plugins/1_ram_arith.html">RAM Arithmetic Plugin</a></li><li><a href="/wiztoolkit/docs/v2.1.0/3_plugins/1_ram_bool_v0.html">RAM Boolean v0 Plugin</a></li><li><a href="/wiztoolkit/docs/v2.1.0/3_plugins/1_wizkit_vectors.html">The Wizkit Vectors Plugin</a></li></ul></li><li>4_tools<ul><li><a href="/wiztoolkit/docs/v2.1.0/4_tools/firealarm.html"><code>wtk-firealarm</code></a></li><li><a href="/wiztoolkit/docs/v2.1.0/4_tools/press.html"><code>wtk-press</code></a></li></ul></li><li><a href="/wiztoolkit/docs/v2.1.0/5_testcases.html">Generating Test Cases with WizToolKit</a></li><li>6_sample_backends<ul><li><a href="/wiztoolkit/docs/v2.1.0/6_sample_backends/0_intro.html">Sample Backend Code</a></li><li class="curr_page"><a href="/wiztoolkit/docs/v2.1.0/6_sample_backends/1_simple.html">Simple Arithmetic Demo Backend</a>
      
    </li><li><a href="/wiztoolkit/docs/v2.1.0/6_sample_backends/2_multitype.html">Arithmetic and Boolean Demo Backend</a></li><li><a href="/wiztoolkit/docs/v2.1.0/6_sample_backends/3_simple_plugins.html">Simple Arithmetic Demo Backend with Plugins</a></li></ul></li><li><a href="/wiztoolkit/docs/v2.1.0/7_install.html">Installing WizToolKit</a></li></ul></li></ul>
  </div>
</nav>

<main id="main" tabindex="-1">
  <h1>Simple Arithmetic Demo Backend</h1>
  <div class="paragraph">
<p>This backend focuses on implementing arithmetic ZK.
Although the sample does demonstrate multiple fields and conversion (field switching), it should be simple enough to just remove converter related stuff.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #000000; color: #dddddd"><code data-lang="c++"><span></span><span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;cstddef&gt;</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;cstdio&gt;</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;vector&gt;</span>

<span style="color: #00ff00">// Parsers</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/Parser.h&gt;                // top level API</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/circuit/Parser.h&gt;        // circuit IR API</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/circuit/Data.h&gt;          // structs used by the circuit parser API</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/irregular/Parser.h&gt;      // text parser implementation</span>

<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/utils/ParserOrganizer.h&gt; // &quot;owner&quot;/&quot;organizer&quot; for parsers</span>

<span style="color: #00ff00">// Backend API</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/TypeBackend.h&gt;           // per-field/type backend callback API</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/Converter.h&gt;             // field switching API</span>

<span style="color: #00ff00">// NAILS Interpreter</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/nails/Interpreter.h&gt;     // main actor of the NAILS API</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/nails/Handler.h&gt;         // bridge between NAILS and the Parser</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/nails/Functions.h&gt;       // helpers for NAILS functions</span>

<span style="color: #00ff00">// Plugin API (boilerplate in this example)</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/plugins/Plugin.h&gt;</span>

<span style="color: #00ff00">// An unbounded (or big enough not to overflow) numeric type.</span>
<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;gmpxx.h&gt;</span>
<span style="color: #ff0000">using</span><span style="color: #dddddd"> Number = mpz_class;</span>
<span style="color: #00ff00">// using Number = uint64_t; </span>

<span style="color: #e5e5e5">#include</span><span style="color: #dddddd"> </span><span style="color: #00ff00">&lt;wtk/utils/NumUtils.gmp.h&gt; // GMP specific hacks</span>

<span style="color: #00ff00">// Struct containing the data carried between gates (&quot;wires&quot;)</span>
<span style="color: #ff0000">struct</span><span style="color: #dddddd"> MyWire { };</span>

<span style="color: #00ff00">// Backend implementation of callbacks</span>
<span style="color: #ff0000">struct</span><span style="color: #dddddd"> MyBackend : wtk::TypeBackend&lt;Number, MyWire&gt;</span>
<span style="color: #dddddd">{</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">bool</span><span style="color: #dddddd"> assertFailure = false;</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// TypeSpec is a wrapper for the IR&#39;s types (field/ring/...)</span>
<span style="color: #dddddd">  MyBackend(wtk::circuit::TypeSpec&lt;Number&gt; </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* t)</span>
<span style="color: #dddddd">    : wtk::TypeBackend&lt;Number, MyWire&gt;(t) { }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $0 &lt;- &lt;0&gt;;</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> assign(MyWire* output, Number&amp;&amp; input_value) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) input_value;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $1 &lt;- $0;</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> copy(MyWire* output, MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* input_wire) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) input_wire;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $2 &lt;- @add($0, $1);</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> addGate(MyWire* output,</span>
<span style="color: #dddddd">      MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* left_input, MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* right_input) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) left_input;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) right_input;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $3 &lt;- @add($1, $2);</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> mulGate(MyWire* output,</span>
<span style="color: #dddddd">      MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* left_input, MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* right_input) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) left_input;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) right_input;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $4 &lt;- @addc($3, &lt;1&gt;);</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> addcGate(MyWire* output,</span>
<span style="color: #dddddd">      MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* left_input, Number&amp;&amp; right_input) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) left_input;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) right_input;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $4 &lt;- @addc($3, &lt;2&gt;);</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> mulcGate(MyWire* output,</span>
<span style="color: #dddddd">      MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* left_input, Number&amp;&amp; right_input) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) left_input;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) right_input;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// @assert_zero($4);</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// Failures may occur, but should get cached until the end when &quot;check()&quot;</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// is called</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> assertZero(MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* input_wire) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) input_wire;</span>
<span style="color: #dddddd">    </span><span style="color: #00ff00">// check that the input wire == 0</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">this</span><span style="color: #dddddd">-&gt;assertFailure = false || </span><span style="color: #ff0000">this</span><span style="color: #dddddd">-&gt;assertFailure;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $5 &lt;- @public_in();</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> publicIn(MyWire* output, Number&amp;&amp; input_value) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) input_value;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// $5 &lt;- @private_in();</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> privateIn(MyWire* output, Number&amp;&amp; input_value) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) output;</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) input_value;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// indicates if any failures occured.</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// Normally true, false on failure.</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">bool</span><span style="color: #dddddd"> check() </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> !</span><span style="color: #ff0000">this</span><span style="color: #dddddd">-&gt;assertFailure;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> finish() </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    </span><span style="color: #00ff00">// optional cleanup tasks.</span>
<span style="color: #dddddd">  }</span>
<span style="color: #dddddd">};</span>

<span style="color: #00ff00">// Subclass the Converter type to implement conversion.</span>
<span style="color: #ff0000">struct</span><span style="color: #dddddd"> MyConverter : </span><span style="color: #ff0000">public</span><span style="color: #dddddd"> wtk::Converter&lt;MyWire, MyWire&gt;</span>
<span style="color: #dddddd">{</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// Maybe you need the output and input primes</span>
<span style="color: #dddddd">  Number outPrime;</span>
<span style="color: #dddddd">  Number inPrime;</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// The parent constructor requires the length of output and input which</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// this Converter will handle.</span>
<span style="color: #dddddd">  MyConverter(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd"> out_len, Number op, </span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd"> in_len, Number ip)</span>
<span style="color: #dddddd">    : wtk::Converter&lt;MyWire, MyWire&gt;(out_len, in_len),</span>
<span style="color: #dddddd">      outPrime(op), inPrime(ip) { }</span>

<span style="color: #dddddd">  </span><span style="color: #ee82ee">void</span><span style="color: #dddddd"> convert(MyWire* </span><span style="color: #ff0000">const</span><span style="color: #dddddd"> out_wires,</span>
<span style="color: #dddddd">      MyWire </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* </span><span style="color: #ff0000">const</span><span style="color: #dddddd"> in_wires, </span><span style="color: #ee82ee">bool</span><span style="color: #dddddd"> modulus) </span><span style="color: #ff0000">override</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    </span><span style="color: #00ff00">// Your Code Here!</span>

<span style="color: #dddddd">    </span><span style="color: #00ff00">// out_wires has length this-&gt;outLength</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) out_wires;</span>
<span style="color: #dddddd">    </span><span style="color: #00ff00">// in_wires has the length this-&gt;inLength</span>
<span style="color: #dddddd">    (</span><span style="color: #ee82ee">void</span><span style="color: #dddddd">) in_wires;</span>

<span style="color: #dddddd">    </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(modulus)</span>
<span style="color: #dddddd">    {</span>
<span style="color: #dddddd">      </span><span style="color: #00ff00">// An overflowing conversion should behave modularly</span>
<span style="color: #dddddd">    }</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">else</span>
<span style="color: #dddddd">    {</span>
<span style="color: #dddddd">      </span><span style="color: #00ff00">// An overflowing conversion should fail</span>
<span style="color: #dddddd">      </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(false</span><span style="color: #00ff00">/* an overflow occurred */</span><span style="color: #dddddd">) { </span><span style="color: #ff0000">this</span><span style="color: #dddddd">-&gt;success = false; }</span>
<span style="color: #dddddd">    }</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// The success or failure is cached until the user calls check at the end.</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">bool</span><span style="color: #dddddd"> success = false;</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">bool</span><span style="color: #dddddd"> </span><span style="color: #ffff00">check</span><span style="color: #dddddd">() </span><span style="color: #ff0000">override</span><span style="color: #dddddd"> { </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> success; }</span>
<span style="color: #dddddd">};</span>

<span style="color: #ee82ee">int</span><span style="color: #dddddd"> </span><span style="color: #ffff00">main</span><span style="color: #dddddd">(</span><span style="color: #ee82ee">int</span><span style="color: #dddddd"> argc, </span><span style="color: #ee82ee">char</span><span style="color: #dddddd"> </span><span style="color: #ff0000">const</span><span style="color: #dddddd">* argv[])</span>
<span style="color: #dddddd">{</span>
<span style="color: #dddddd">  wtk::utils::ParserOrganizer&lt;wtk::irregular::Parser&lt;Number&gt;, Number&gt; organizer;</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Open and organize files</span>
<span style="color: #dddddd">  </span><span style="color: #ff0000">for</span><span style="color: #dddddd">(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd"> i = 1; i &lt; (</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd">) argc; i++)</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(!organizer.open(argv[i]))</span>
<span style="color: #dddddd">    {</span>
<span style="color: #dddddd">      printf(</span><span style="color: #87ceeb">&quot;failed to open %s\n&quot;</span><span style="color: #dddddd">, argv[i]);</span>
<span style="color: #dddddd">      </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> 1;</span>
<span style="color: #dddddd">    }</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  wtk::utils::Setting setting = organizer.organize();</span>
<span style="color: #dddddd">  </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(setting == wtk::utils::Setting::failure)</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    printf(</span><span style="color: #87ceeb">&quot;failed to organize inputs\n&quot;</span><span style="color: #dddddd">);</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> 1;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Create a nails interpreter</span>
<span style="color: #dddddd">  wtk::nails::Interpreter&lt;Number&gt; interpreter(organizer.circuitName);</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Check for plugins, because they are not yet supported.</span>
<span style="color: #dddddd">  </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(organizer.circuitBodyParser-&gt;plugins.size() != 0)</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    printf(</span><span style="color: #87ceeb">&quot;plugins are not yet supported\n&quot;</span><span style="color: #dddddd">);</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> 1;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Create storage for backends, one backend for each type/field</span>
<span style="color: #dddddd">  std::vector&lt;MyBackend&gt; backends;</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// Reserve is necessary otherwise multiple fields (vector growths)</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// invalidate prior pointers.</span>
<span style="color: #dddddd">  backends.reserve(organizer.circuitBodyParser-&gt;types.size());</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Create each type/field in the same order as required by the relation</span>
<span style="color: #dddddd">  </span><span style="color: #ff0000">for</span><span style="color: #dddddd">(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd"> i = 0; i &lt; organizer.circuitBodyParser-&gt;types.size(); i++)</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    wtk::circuit::TypeSpec&lt;Number&gt;* </span><span style="color: #ff0000">const</span><span style="color: #dddddd"> type =</span>
<span style="color: #dddddd">      &amp;organizer.circuitBodyParser-&gt;types[i];</span>

<span style="color: #dddddd">    </span><span style="color: #00ff00">// Check that its a field not a plugin type.</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(type-&gt;variety != wtk::circuit::TypeSpec&lt;Number&gt;::field)</span>
<span style="color: #dddddd">    {</span>
<span style="color: #dddddd">      printf(</span><span style="color: #87ceeb">&quot;Type %zu is a plugin (not yet supported)\n&quot;</span><span style="color: #dddddd">, i);</span>
<span style="color: #dddddd">      </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> 1;</span>
<span style="color: #dddddd">    }</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">else</span>
<span style="color: #dddddd">    {</span>
<span style="color: #dddddd">      </span><span style="color: #00ff00">// construct another backend with this type</span>
<span style="color: #dddddd">      backends.emplace_back(type);</span>
<span style="color: #dddddd">      </span><span style="color: #00ff00">// add the backend and its streams to the interpreter</span>
<span style="color: #dddddd">      interpreter.addType(&amp;backends.back(),</span>
<span style="color: #dddddd">          organizer.circuitStreams[i].publicStream,</span>
<span style="color: #dddddd">          organizer.circuitStreams[i].privateStream);</span>
<span style="color: #dddddd">    }</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Create a storage vector for converters, one for each ConversionSpec</span>
<span style="color: #dddddd">  std::vector&lt;MyConverter&gt; converters;</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// Reserve necessary space, otherwise vector growth will invalidate pointers</span>
<span style="color: #dddddd">  converters.reserve(organizer.circuitBodyParser-&gt;conversions.size());</span>

<span style="color: #dddddd">  </span><span style="color: #ff0000">for</span><span style="color: #dddddd">(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd"> i = 0; i &lt; organizer.circuitBodyParser-&gt;conversions.size(); i++)</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    </span><span style="color: #00ff00">// pointer to the conversion spec (outType, outLength, inType, inLength)</span>
<span style="color: #dddddd">    wtk::circuit::ConversionSpec* </span><span style="color: #ff0000">const</span><span style="color: #dddddd"> spec =</span>
<span style="color: #dddddd">      &amp;organizer.circuitBodyParser-&gt;conversions[i];</span>

<span style="color: #dddddd">    </span><span style="color: #00ff00">// get the TypeSpecs corresponding to the out and input types.</span>
<span style="color: #dddddd">    wtk::circuit::TypeSpec&lt;Number&gt;* </span><span style="color: #ff0000">const</span><span style="color: #dddddd"> out_type =</span>
<span style="color: #dddddd">      &amp;organizer.circuitBodyParser-&gt;types[(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd">) spec-&gt;outType];</span>
<span style="color: #dddddd">    wtk::circuit::TypeSpec&lt;Number&gt;* </span><span style="color: #ff0000">const</span><span style="color: #dddddd"> in_type =</span>
<span style="color: #dddddd">      &amp;organizer.circuitBodyParser-&gt;types[(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd">) spec-&gt;inType];</span>

<span style="color: #dddddd">    </span><span style="color: #00ff00">// call the constructor for our converter</span>
<span style="color: #dddddd">    converters.emplace_back(</span>
<span style="color: #dddddd">        spec-&gt;outLength, out_type-&gt;prime, spec-&gt;inLength, in_type-&gt;prime);</span>
<span style="color: #dddddd">    </span><span style="color: #00ff00">// add the converter to the interpreter</span>
<span style="color: #dddddd">    interpreter.addConversion(spec, &amp;converters.back());</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Create the nails handler (accepts/directs gates from the parser)</span>
<span style="color: #dddddd">  wtk::nails::GatesFunctionFactory&lt;Number&gt; func_factory;        </span><span style="color: #00ff00">// boilerplate</span>
<span style="color: #dddddd">  wtk::plugins::PluginsManager&lt;Number, MyWire&gt; plugins_manager; </span><span style="color: #00ff00">// boilerplate</span>
<span style="color: #dddddd">  wtk::nails::Handler&lt;Number&gt; handler(</span>
<span style="color: #dddddd">      &amp;interpreter, &amp;func_factory, &amp;plugins_manager);</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// parse the relation and pass each gate off through NAILS and into</span>
<span style="color: #dddddd">  </span><span style="color: #00ff00">// the backends.</span>
<span style="color: #dddddd">  </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(!organizer.circuitBodyParser-&gt;parse(&amp;handler))</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    printf(</span><span style="color: #87ceeb">&quot;parser failure\n&quot;</span><span style="color: #dddddd">);</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> 1;</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Check that all the fields succeeded</span>
<span style="color: #dddddd">  </span><span style="color: #ee82ee">int</span><span style="color: #dddddd"> ret = 0;</span>
<span style="color: #dddddd">  </span><span style="color: #ff0000">for</span><span style="color: #dddddd">(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd"> i = 0; i &lt; backends.size(); i++)</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(!backends[i].check())</span>
<span style="color: #dddddd">    {</span>
<span style="color: #dddddd">      printf(</span><span style="color: #87ceeb">&quot;failure in field %zu\n&quot;</span><span style="color: #dddddd">, i);</span>
<span style="color: #dddddd">      ret = 1;</span>
<span style="color: #dddddd">    }</span>

<span style="color: #dddddd">    backends[i].finish();</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #00ff00">// Check that all the conversions succeeded</span>
<span style="color: #dddddd">  </span><span style="color: #ff0000">for</span><span style="color: #dddddd">(</span><span style="color: #ee82ee">size_t</span><span style="color: #dddddd"> i = 0; i &lt; converters.size(); i++)</span>
<span style="color: #dddddd">  {</span>
<span style="color: #dddddd">    </span><span style="color: #ff0000">if</span><span style="color: #dddddd">(!converters[i].check())</span>
<span style="color: #dddddd">    {</span>
<span style="color: #dddddd">      printf(</span><span style="color: #87ceeb">&quot;failure during conversion\n&quot;</span><span style="color: #dddddd">);</span>
<span style="color: #dddddd">      ret = 1;</span>
<span style="color: #dddddd">    }</span>
<span style="color: #dddddd">  }</span>

<span style="color: #dddddd">  </span><span style="color: #ff0000">return</span><span style="color: #dddddd"> ret;</span>
<span style="color: #dddddd">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="./simple.cpp">Download the C++</a> in case the above does not display or you wish to modify the example.</p>
</div>
</main>

    <footer>
      
        <p id="distributionStatement">
          <strong>Distribution Statement A:</strong> Approved for Public Release, Distribution Unlimited.
        </p>
      
      <p>
        Copyright &copy; 2023, Stealth Software Technologies, Inc.
        All Rights Reserved.
      </p>
      
        <p id="acknowledgement">
          This research was developed with funding from the Defense Advanced Research Projects Agency (DARPA) under Contract No. HR001120C0087. The views, opinions, and/or findings expressed are those of the author(s) and should not be interpreted as representing the official views or policies of the Department of Defense or the U.S. Government.
        </p>
      

      <a href="https://www.stealthsoftwareinc.com" id="bottomLogoImg">
        <img
          src="/wiztoolkit/assets/icons/tetra-solid-400x100.png"
          alt="Stealth Software Technologies Home Page" /></a>

      
    </footer>
  </body>
</html>

